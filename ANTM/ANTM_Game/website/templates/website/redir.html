{% extends "base.html" %}

{% block title %} You've Selected! {% endblock %}

{% block content %}

<a href = "{% url 'welcome' %}">Home</a>
<br>
<br>
{% if wordbank %}
  <table>
    <p>Cycle {{cyc_id}} Contestants</p>
    <ul id="items-list" class='movable'>
    {% for ml in my_list_shuff %}
      <li style="border: 1px solid black; padding:3px; width:fit-content;">{{ml}}</li>
      <br>
    {% endfor %}
    </ul>
    <script>
      let items = document.querySelectorAll('#items-list > li')

items.forEach(item => {
  $(item).prop('draggable', true)
  item.addEventListener('dragstart', dragStart)
  item.addEventListener('drop', dropped)
  item.addEventListener('dragenter', cancelDefault)
  item.addEventListener('dragover', cancelDefault)
})

function dragStart (e) {
  var index = $(e.target).index()
  e.dataTransfer.setData('text/plain', index)
}

function dropped (e) {
  cancelDefault(e)

  // get new and old index
  let oldIndex = e.dataTransfer.getData('text/plain')
  let target = $(e.target)
  let newIndex = target.index()

  // remove dropped items at old place
  let dropped = $(this).parent().children().eq(oldIndex).remove()

  // insert the dropped items at new place
  if (newIndex < oldIndex) {
    target.before(dropped)
  } else {
    target.after(dropped)
  }
}

function cancelDefault (e) {
  e.preventDefault()
  e.stopPropagation()
  return false
}
</script>
  {% else %}
    <form id = 'myform' autofill='off' name = 'fillform' class='form-creation' method='POST'>
      <script>
        const data = {{my_list | safe}};
        const optList = {{options_list | safe}}
        </script>

      {% csrf_token %}
      {% for ml, opt in opt_list %}
        <input name = '{{ml}}' id = '{{ml}}' type='text' onKeyUp="showResults(this.id, this.value)" maxlength="20"></input><br>
        <ul id='{{opt}}'></ul>
        <script>
          function autocompleteMatch(input) {
            if (input == '') {
              return [];
            }
            var reg = new RegExp(input)
            return data.filter(function(term) {
          	  if (term.match(reg)) {
            	  return term;
          	  };
            });
          };

          function showResults(val1, val2) {
            var ind = data.indexOf(val1)
            var res = document.getElementById(optList[ind])
            var autocomplete = document.getElementById(val1)
            res.innerHTML = '';
            let list = '';
            let terms = autocompleteMatch(val2);
            for (i=0; i<terms.length; i++) {
              list += '<li>' + terms[i] + '</li>';
            }
            res.innerHTML = '<ul>' + list + '</ul>';
                      res.onclick= function (event) {
                        const setValue = event.target.innerText;
                        autocomplete.value = setValue;
                        this.innerHTML = '';
                      };
          };
        </script>

      {% endfor %}
      <button type="submit">Submit</button>
      </form>
    {% endif %}

{% endblock %}
